<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Detalle del producto — WapMarket</title>
  <link rel="stylesheet" href="/styles.css">
  <style>
    body{background:#eaeded;font-family:Arial,sans-serif;margin:0;padding:0;color:#111;}
    header{background:#131921;color:#fff;padding:12px;display:flex;align-items:center;justify-content:space-between}
    header .logo{font-weight:900;font-size:1.4rem}
    main{max-width:1200px;margin:20px auto;padding:16px;display:grid;grid-template-columns:1fr 1fr;gap:20px;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,.1)}
    .img-wrap img{width:100%;border:1px solid #ddd;object-fit:contain;border-radius:6px}
    .meta h1{margin-top:0;font-size:1.6rem}
    .price{color:#B12704;font-size:1.3rem;font-weight:800;margin:10px 0}
    .badge{display:inline-flex;align-items:center;gap:6px;background:#f3f3f3;padding:6px 10px;border-radius:999px;font-size:.9rem}
    .verified-badge img{width:20px;height:20px;object-fit:contain}
    .btn{background:#febd69;color:#111;border:1px solid #f0a947;padding:10px 16px;border-radius:20px;font-weight:700;cursor:pointer;box-shadow:0 2px 6px rgba(0,0,0,.1);margin-top:12px}
    .btn:hover{background:#f3a847}
    .desc{margin-top:16px;font-size:1rem;line-height:1.4}
    @media(max-width:768px){main{grid-template-columns:1fr}}
  </style>
</head>
<body>
<header>
  <div class="logo">WapMarket</div>
  <button class="btn" onclick="openCart()">Carrito</button>
</header>

<main>
  <div class="img-wrap">
    <img id="prodImg" src="https://placehold.co/600x600?text=Producto" alt="Producto">
  </div>
  <div class="meta">
    <h1 id="prodTitle">Producto</h1>
    <div class="badge"><span id="prodCat">Categoría</span> <span id="bizBadge"></span></div>
    <div class="price" id="prodPrice">0 XAF</div>
    <button class="btn" id="addBtn">Añadir al carrito</button>
    <div class="desc" id="prodDesc">Descripción del producto...</div>
  </div>
</main>

<script src="/api.js"></script>
<script>
let cart = JSON.parse(localStorage.getItem('cart')||'[]');
function saveCart(){localStorage.setItem('cart',JSON.stringify(cart));}

function openCart(){window.location.href='/market_amazon_v3.html#cart';}

async function loadProduct(){
  const params = new URLSearchParams(window.location.search);
  const id = params.get('id');
  if(!id) return;
  const data = await API.get('/public/products/'+id);
  if(!data) return;
  document.getElementById('prodImg').src = data.image_url||'https://placehold.co/600x600?text=WapMarket';
  document.getElementById('prodTitle').textContent = data.title;
  document.getElementById('prodCat').textContent = data.category||'';
  document.getElementById('prodPrice').textContent = (data.price_xaf?Number(data.price_xaf).toLocaleString():'0')+' XAF';
  document.getElementById('prodDesc').textContent = data.description||'Sin descripción';
  if(data.business && data.business.business_type==='verified'){
    document.getElementById('bizBadge').innerHTML='<img src="/aset/icons8-verified-50.png" alt="Verificado">';
  }
  document.getElementById('addBtn').onclick=()=>{
    if(cart.length && cart[0].business_id!==data.business_id){
      if(!confirm('Tu carrito es de otro negocio. ¿Vaciar carrito?')) return;
      cart=[];
    }
    const exists = cart.find(x=>x.id==data.id);
    if(exists) exists.qty=Number(exists.qty||1)+1;
    else cart.push({id:data.id,title:data.title,price_xaf:data.price_xaf,image_url:data.image_url,category:data.category,qty:1,business_id:data.business_id});
    saveCart();
    alert('Producto añadido al carrito');
  };
}
loadProduct();
</script>
</body>
</html>
