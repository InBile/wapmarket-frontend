<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>WapMarket — Marketplace GE</title>
  <link rel="stylesheet" href="/styles.css">
  <style>
    /* === Amazon-like base style === */
    :root{
      --amz-dark:#131921;
      --amz-light:#232f3e;
      --amz-yellow:#febd69;
      --amz-link:#007185;
      --amz-border:#e6e6e6;
      --gap:16px;
    }
    body{margin:0;background:#eaeded;font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","Helvetica Neue",Arial}
    .header{position:sticky;top:0;z-index:50;background:var(--amz-dark);color:#fff}
    .header .wrapper{display:flex;align-items:center;gap:12px;justify-content:space-between;max-width:1200px;margin:0 auto;padding:10px 12px}
    .logo{font-weight:800;letter-spacing:.2px;font-size:1.5rem}
    .search{flex:1;display:flex;max-width:700px}
    .search input{flex:1;border:1px solid var(--amz-border);border-radius:4px 0 0 4px;padding:10px;color:#111}
    #btnBuscar{background:var(--amz-yellow);border:1px solid #f0a947;border-radius:0 4px 4px 0;padding:0 16px;cursor:pointer;font-weight:700}
    #btnOpenCart{background:transparent;border:1px solid rgba(255,255,255,.3);border-radius:4px;color:#fff;height:40px;display:inline-flex;align-items:center;gap:4px;padding:0 12px}
    #btnOpenCart:hover{background:rgba(255,255,255,.08)}
    .layout{display:grid;grid-template-columns:280px 1fr;gap:var(--gap);max-width:1200px;margin:16px auto;padding:0 12px}
    @media(max-width:900px){.layout{grid-template-columns:1fr}aside{order:2}section{order:1}}
    .card{background:#fff;border:1px solid var(--amz-border);padding:14px;border-radius:4px}
    #bizList>div{border:1px solid var(--amz-border);padding:12px;border-radius:4px;margin-bottom:8px;cursor:pointer;transition:background .2s}
    #bizList>div:hover{background:#f3f3f3}
    #results.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:var(--gap)}
    .product-item{background:#fff;border:1px solid var(--amz-border);padding:8px;display:flex;flex-direction:column;gap:6px;transition:box-shadow .15s}
    .product-item:hover{box-shadow:0 2px 8px rgba(0,0,0,.1)}
    .product-item img.thumb{width:100%;aspect-ratio:4/3;object-fit:cover}
    .price{color:#B12704;font-weight:800}
    .wa-carousel-wrap{border:1px solid var(--amz-border);background:#fff;border-radius:4px;overflow:hidden;position:relative}
    .wa-carousel{display:flex;transition:transform .4s ease}
    .wa-slide{min-width:100%}
    .wa-slide img{width:100%;height:220px;object-fit:cover}
    .wa-nav{display:flex;justify-content:space-between;align-items:center;margin-top:6px}
    .wa-btn{background:var(--amz-light);color:#fff;border:none;width:34px;height:34px;cursor:pointer}
    .wa-dots{display:flex;gap:6px;flex:1;justify-content:center}
    .wa-dot{width:8px;height:8px;border-radius:50%;background:#c7c7c7;border:none}
    .wa-dot.active{background:#111}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:flex-end;justify-content:flex-end;z-index:9999}
    .dialog{background:#fff;width:min(480px,100%);height:100%;overflow:auto;padding:16px}
  </style>
</head>
<body>
<header class="header">
  <div class="wrapper">
    <div class="logo">WapMarket</div>
    <form id="searchForm" class="search" onsubmit="return false;">
      <input id="q" placeholder="Buscar productos..." autocomplete="off" />
      <button id="btnBuscar">Buscar</button>
    </form>
    <a href="#" id="btnOpenCart" data-has-items="false"><img src="/aset/icons8-buy-64.png" alt="Carrito" style="width:20px;height:20px">Carrito</a>
  </div>
</header>

<main class="layout">
  <aside>
    <div class="card"><h3>Negocios disponibles</h3><div id="bizList"></div></div>
    <div class="card" style="margin-top:16px"><h3>Filtros</h3><div class="chips" id="chips"></div><select id="category" style="display:none"></select></div>
  </aside>
  <section>
    <div class="card"><h3 id="bizTitle">Selecciona un negocio</h3><div id="results" class="grid"></div><div style="text-align:center;margin-top:10px"><button id="nextBtn" class="btn" style="display:none">Ver más</button></div></div>
    <section class="wa-ads"><h3>Publicidad</h3>
      <div class="wa-carousel-wrap"><div class="wa-carousel" id="waCarousel"></div></div>
      <div class="wa-nav">
        <button class="wa-btn" data-dir="-1">‹</button>
        <div class="wa-dots" id="waDots"></div>
        <button class="wa-btn" data-dir="1">›</button>
      </div>
    </section>
  </section>
</main>

<div class="modal" id="cartModal"><div class="dialog"><h3>Tu carrito</h3><div id="cartItems"></div><div id="totals" style="font-weight:800"></div></div></div>

<script src="/api.js"></script>
<script>
// ========== JS original mejorado ==========
let selectedBusiness=null,cart=JSON.parse(localStorage.getItem('cart')||'[]'),currentProducts=[],pageSize=20,currentPage=1;
function saveCart(){localStorage.setItem('cart',JSON.stringify(cart));}
async function loadBusinesses(){const data=await API.get('/public/businesses');const box=document.getElementById('bizList');box.innerHTML='';(data.items||[]).forEach(b=>{const el=document.createElement('div');el.innerHTML='<strong>'+b.name+'</strong><div class="small">'+(b.location||'')+'</div>';el.addEventListener('click',()=>setBusiness(b));box.appendChild(el)});if((data.items||[]).length) setBusiness(data.items[0]);}
function setBusiness(b){selectedBusiness=b;document.getElementById('bizTitle').textContent='Productos de '+b.name;loadProducts();}
async function loadProducts(){if(!selectedBusiness) return;const q=document.getElementById('q').value.trim();const params=new URLSearchParams();params.set('business_id',selectedBusiness.id);if(q) params.set('q',q);const data=await API.get('/public/products?'+params.toString());currentProducts=data.items||[];renderProductsPage();}
function renderProductsPage(){const list=document.getElementById('results');list.innerHTML='';const start=(currentPage-1)*pageSize;currentProducts.slice(start,start+pageSize).forEach(p=>{const el=document.createElement('div');el.className='product-item';el.innerHTML='<img class="thumb" src="'+(p.image_url||'https://placehold.co/600x400?text=WapMarket')+'"><div><div class="price">'+(p.price_xaf?Number(p.price_xaf).toLocaleString()+' XAF':'')+'</div><button class="btn" data-id="'+p.id+'">Añadir</button></div>';list.appendChild(el)});}
// WhatsApp carousel init
(function(){const car=document.getElementById('waCarousel');const dots=document.getElementById('waDots');const slides=[{img:'/aset/Captura de pantalla 2025-07-07 a la(s) 19.02.16.png',txt:'Wap Tech & Services',link:'https://wa.me/240555218661'},{img:'/aset/app-check-hero_2x.png',txt:'CiberSeguridad Prisma',link:'https://wa.me/240555218661'}];car.innerHTML=slides.map(s=>'<div class="wa-slide"><a href="'+s.link+'" target="_blank"><img src="'+s.img+'"><p>'+s.txt+'</p></a></div>').join('');dots.innerHTML='';slides.forEach((_,i)=>{const d=document.createElement('button');d.className='wa-dot'+(i===0?' active':'');d.onclick=()=>go(i);dots.appendChild(d)});let idx=0;function go(i){idx=(i+slides.length)%slides.length;car.style.transform='translateX(-'+idx*100+'%)';[...dots.children].forEach((d,j)=>d.classList.toggle('active',j===idx));}document.querySelectorAll('.wa-btn').forEach(b=>b.onclick=()=>go(idx+Number(b.dataset.dir)));})();
loadBusinesses();
</script>
</body>
</html>
